<section class="admin-subpage-tools card">
<p-toolbar >
  <ng-template #start>
    <p-button [label]="'MENU.CREATE_ISSUE' | translate" icon="pi pi-plus" severity="primary" class="mr-2" (onClick)="openNewIssue()" />
      <!-- <p-button severity="secondary" [label]="'MENU.DELETE' | translate" icon="pi pi-trash" outlined (onClick)="deleteSelectedIssues()" [disabled]="!selectedIssues || !selectedIssues.length" /> -->
      <p-button severity="warn" icon="pi pi-filter" class="ml-2" (onClick)="openQueryDialog()" />
      <p-button severity="secondary" icon="pi pi-pencil" class="ml-2" (onClick)="openBulkEditDialog()" [disabled]="!selectedIssues || !selectedIssues.length" />
  </ng-template>

  <ng-template #end>
      <p-button [label]="'MENU.EXPORT' | translate" icon="pi pi-upload" severity="secondary" (onClick)="exportIssuesCSV()" />
  </ng-template>
</p-toolbar>
</section>

<section class="admin-subpage-content card">
    <div class="table-responsive" #tableContainer>
  <p-table
      #dt
      [value]="issuesItems"
      [loading]="loading"
      styleClass="issues-table"
    [reorderableColumns]="true"
    (onColReorder)="onColumnsReordered($event)"
    (onColResize)="onColumnResized($event)"
      [scrollable]="true"
      [resizableColumns]="true"
      columnResizeMode="expand"
      scrollHeight="flex"
      [rows]="10"
      size="small"
      [globalFilterFields]="['id','title','project_name','assignee_name','author_name','status_name','type_name','priority_text']"
      [(selection)]="selectedIssues"
      [rowHover]="true"
      dataKey="id"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      [showCurrentPageReport]="true"
      [rowsPerPageOptions]="[10, 20, 30]"
          >

    <ng-template #caption>
            <div class="flex justify-between mb-2 items-center">
                <h3>{{ 'MENU.ISSUES' | translate }}</h3>
                <div class="flex items-center gap-2">
                    <p-multiSelect [options]="columnsOptions" [(ngModel)]="selectedColumns" (onChange)="onColumnsChange()" placeholder="{{ 'MENU.COLUMNS' | translate }}" appendTo="body" styleClass="mr-2"></p-multiSelect>
                    <p-iconfield>
                        <p-inputicon styleClass="pi pi-search" /> 
                        <input pInputText type="text" (input)="onGlobalFilterIssue(dt, $event)" placeholder="{{ 'components.issues.table.SEARCH' | translate }}" />
                    </p-iconfield>
                </div>
            </div>
            </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th style="width: 3rem" pResizableColumn>
                    <p-tableHeaderCheckbox />
                </th>

                <!-- render headers from columns array so order is consistent -->
                <ng-container *ngFor="let col of columns">
                    <th *ngIf="isColumnVisible(col.field)" [attr.data-field]="col.field" pReorderableColumn [pSortableColumn]="col.field" pResizableColumn>
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <span>{{ (col.headerKey | translate) }}</span>
                                <p-sortIcon [field]="col.field" />
                            </div>

                            <!-- filters for specific columns -->
                            <ng-container [ngSwitch]="col.field">
                                <ng-container *ngSwitchCase="'project_name'">
                                    <p-columnFilter field="project_name" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
                                        <ng-template #filter let-value let-filter="filterCallback">
                                            <p-multiselect [ngModel]="value"
                                                           [options]="projectOptions"
                                                           optionLabel="label"
                                                           optionValue="label"
                                                           placeholder="{{ 'MENU.ANY' | translate }}"
                                                           (onChange)="filter($event.value)"
                                                           styleClass="w-full"
                                                           appendTo="body">
                                            </p-multiselect>
                                        </ng-template>
                                    </p-columnFilter>
                                </ng-container>
                                <ng-container *ngSwitchCase="'assignee_name'">
                                    <p-columnFilter field="assignee_name" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
                                        <ng-template #filter let-value let-filter="filterCallback">
                                            <p-multiselect [ngModel]="value"
                                                           [options]="usersOptions"
                                                           optionLabel="label"
                                                           optionValue="label"
                                                           placeholder="{{ 'MENU.ANY' | translate }}"
                                                           (onChange)="filter($event.value)"
                                                           styleClass="w-full"
                                                           appendTo="body">
                                            </p-multiselect>
                                        </ng-template>
                                    </p-columnFilter>
                                </ng-container>
                                <ng-container *ngSwitchCase="'author_name'">
                                    <p-columnFilter field="author_name" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
                                        <ng-template #filter let-value let-filter="filterCallback">
                                            <p-multiselect [ngModel]="value"
                                                           [options]="usersOptions"
                                                           optionLabel="label"
                                                           optionValue="label"
                                                           placeholder="{{ 'MENU.ANY' | translate }}"
                                                           (onChange)="filter($event.value)"
                                                           styleClass="w-full"
                                                           appendTo="body">
                                            </p-multiselect>
                                        </ng-template>
                                    </p-columnFilter>
                                </ng-container>
                                <ng-container *ngSwitchCase="'status_name'">
                                    <p-columnFilter field="status_name" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
                                        <ng-template #filter let-value let-filter="filterCallback">
                                            <p-multiselect [ngModel]="value"
                                                           [options]="statusOptions"
                                                           optionLabel="label"
                                                           optionValue="label"
                                                           placeholder="{{ 'MENU.ANY' | translate }}"
                                                           (onChange)="filter($event.value)"
                                                           styleClass="w-full"
                                                           appendTo="body">
                                            </p-multiselect>
                                        </ng-template>
                                    </p-columnFilter>
                                </ng-container>
                                <ng-container *ngSwitchCase="'type_name'">
                                    <p-columnFilter field="type_name" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
                                        <ng-template #filter let-value let-filter="filterCallback">
                                            <p-multiselect [ngModel]="value"
                                                           [options]="typeOptions"
                                                           optionLabel="label"
                                                           optionValue="label"
                                                           placeholder="{{ 'MENU.ANY' | translate }}"
                                                           (onChange)="filter($event.value)"
                                                           styleClass="w-full"
                                                           appendTo="body">
                                            </p-multiselect>
                                        </ng-template>
                                    </p-columnFilter>
                                </ng-container>
                                <ng-container *ngSwitchCase="'priority_text'">
                                    <p-columnFilter field="priority_text" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
                                        <ng-template #filter let-value let-filter="filterCallback">
                                            <p-multiselect [ngModel]="value"
                                                           [options]="priorityOptions"
                                                           optionLabel="label"
                                                           optionValue="label"
                                                           placeholder="{{ 'MENU.ANY' | translate }}"
                                                           (onChange)="filter($event.value)"
                                                           styleClass="w-full"
                                                           appendTo="body">
                                            </p-multiselect>
                                        </ng-template>
                                    </p-columnFilter>
                                </ng-container>
                                <ng-container *ngSwitchDefault></ng-container>
                            </ng-container>
                        </div>
                    </th>
                </ng-container>

                <th pResizableColumn></th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-issue>
            <tr (click)="onRowClick(issue, $event)">
                <td>
                    <p-tableCheckbox [value]="issue" />
                </td>

                <!-- render body cells in same order as columns array -->
                <ng-container *ngFor="let col of columns">
                    <td *ngIf="isColumnVisible(col.field)" [attr.data-field]="col.field">
                        <ng-container [ngSwitch]="col.field">
                            <ng-container *ngSwitchCase="'id'">{{ issue.id }}</ng-container>
                            <ng-container *ngSwitchCase="'project_name'">{{ projectCode(issue) || '-' }}</ng-container>
                            <ng-container *ngSwitchCase="'title'">{{ issue.title || '-' }}</ng-container>
                            <ng-container *ngSwitchCase="'type_name'">{{ issue.type_name || '-' }}</ng-container>
                            <ng-container *ngSwitchCase="'assignee_name'">
                                <div class="flex items-center gap-2">
                                            <ng-container *ngIf="issue.assignee_avatar || issue.assignee_avatar_url; else assigneeInitials">
                                                <p-avatar [image]="issue.assignee_avatar || issue.assignee_avatar_url" class="mr-2" shape="circle" >
                                                </p-avatar>
                                            </ng-container>
                                            <ng-template #assigneeInitials>
                                                <div class="user-avatar user-avatar-initials mr-2"
                                                     [style.background]="issue.assignee_id ? issueAvatarColor({ id: issue.assignee_id, first_name: issue.assignee_name }) : undefined"
                                                     [style.color]="issue.assignee_id ? issueAvatarTextColor({ id: issue.assignee_id, first_name: issue.assignee_name }) : undefined">
                                                    {{ initialsFromName(issue.assignee_name) }}
                                                </div>
                                            </ng-template>
                                            <span>{{ formatSurnameInitials(issue.assignee_name || issue) }}</span>
                                </div>
                            </ng-container>
                            <ng-container *ngSwitchCase="'author_name'">
                                <div class="flex items-center gap-2">
                                    <ng-container *ngIf="issue.author_avatar || issue.author_avatar_url; else authorInitials">
                                        <p-avatar [image]="issue.author_avatar || issue.author_avatar_url" class="mr-2" shape="circle"></p-avatar>
                                    </ng-container>
                                    <ng-template #authorInitials>
                                        <div class="user-avatar user-avatar-initials mr-2"
                                             [style.background]="issue.author_id ? issueAvatarColor({ id: issue.author_id, first_name: issue.author_name }) : undefined"
                                             [style.color]="issue.author_id ? issueAvatarTextColor({ id: issue.author_id, first_name: issue.author_name }) : undefined">
                                            {{ initialsFromName(issue.author_name) }}
                                        </div>
                                    </ng-template>
                                    <span>{{ formatSurnameInitials(issue.author_name || issue) }}</span>
                                </div>
                            </ng-container>
                            <ng-container *ngSwitchCase="'status_name'">
                                <p-tag [value]="issue.status_name || '-'" [severity]="statusSeverity(issue.status_code)"></p-tag>
                            </ng-container>
                            <ng-container *ngSwitchCase="'priority_text'">
                                <p-tag [value]="issue.priority_text || (issue.priority || '-')" [severity]="prioritySeverity(issue.priority)"></p-tag>
                            </ng-container>
                            <ng-container *ngSwitchCase="'estimated_hours'">{{ issue.estimated_hours || '-' }}</ng-container>
                            <ng-container *ngSwitchCase="'start_date'">{{ issue.start_date ? (issue.start_date | date:'dd.MM.yyyy') : '-' }}</ng-container>
                            <ng-container *ngSwitchCase="'due_date'">{{ issue.due_date ? (issue.due_date | date:'dd.MM.yyyy') : '-' }}</ng-container>
                            <ng-container *ngSwitchCase="'created_at'">{{ issue.created_at ? (issue.created_at | date:'dd.MM.yyyy') : '-' }}</ng-container>
                            <ng-container *ngSwitchDefault>{{ issue[col.field] }}</ng-container>
                        </ng-container>
                    </td>
                </ng-container>

                <td></td>
            </tr>
        </ng-template>
</p-table>
</div>
</section>

<p-confirmDialog
    appendTo="body"
    [dismissableMask]="true"
    [baseZIndex]="10000"
    [style]="{ width: '25%' }"
    styleClass="user-confirm-dialog"
    header="{{ 'MENU.CONFIRM' | translate }}"
    acceptLabel="{{ 'MENU.DELETE' | translate }}"
    rejectLabel="{{ 'MENU.CANCEL' | translate }}"
    acceptIcon="pi pi-check"
    acceptButtonStyleClass="p-button-danger"
    rejectButtonStyleClass="secondary p-button-text"
    rejectIcon="pi pi-times"
    >
</p-confirmDialog>
<p-toast position="top-right" appendTo="body" [baseZIndex]="10001" styleClass="user-toast"></p-toast>

<p-dialog [header]="isCreating ? ('MENU.CREATE_ISSUE' | translate) : ('MENU.EDIT_ISSUE' | translate)" [(visible)]="displayDialog" [modal]="true" [closable]="true" [resizable]="false" [style]="{width: '40%'}">
        <div class=" flex flex-col gap-4">
            <div class="flex gap-2">
                <div class="flex-1 flex flex-col gap-2">
                    <label for="projectId" class="font-bold">{{ 'components.issues.form.PROJECT' | translate }}</label>
                    <p-select id="projectId" [options]="projectOptions" [(ngModel)]="editModel.project_id" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.SELECT' | translate }}" appendTo="body">
                        <ng-template let-opt pTemplate="item">
                            <div class="flex items-center gap-2">
                                <div>{{ opt.label }}</div>
                            </div>
                        </ng-template>
                        <ng-template let-opt pTemplate="value">
                            <div class="flex items-center gap-2">
                                <div>{{ opt.label }}</div>
                            </div>
                        </ng-template>
                    </p-select>
                    <small *ngIf="formErrors.project_id" class="text-red-600 block">{{ formErrors.project_id }}</small>
                </div>

                <div class="w-60 flex flex-col gap-2">
                    <label for="typeId" class="font-bold">{{ 'components.issues.form.TYPE' | translate }}</label>
                    <p-select id="typeId" [options]="typeOptions" [(ngModel)]="editModel.type_id" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.ANY' | translate }}" appendTo="body"></p-select>
                </div>
            </div>

            <div class="flex flex-col gap-2">
                <label for="title" class="font-bold">{{ 'components.issues.form.TITLE' | translate }}</label>
                <input pInputText id="title" type="text" [(ngModel)]="editModel.title" name="title" />
                <small *ngIf="formErrors.title" class="text-red-600 block">{{ formErrors.title }}</small>
            </div>

            <div class="flex flex-col gap-2">
                <label for="description" class="font-bold">{{ 'components.issues.form.DESCRIPTION' | translate }}</label>
                <p-editor id="description" [(ngModel)]="editModel.description" name="description" styleClass="w-full" [style]="{ height: '100px' }"></p-editor>
            </div>

            <div class="flex gap-2">
                <div class="flex-1 flex flex-col gap-2">
                    <label for="assigneeId" class="font-bold">{{ 'components.issues.form.ASSIGNEE' | translate }}</label>
                    <p-select id="assigneeId" [options]="usersOptions" [(ngModel)]="editModel.assignee_id" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.ANY' | translate }}" appendTo="body">
                        <ng-template let-opt pTemplate="item">
                            <div class="flex items-center gap-2">
                                <ng-container *ngIf="opt.avatar; else initialsItem">
                                    <img [src]="opt.avatar" alt="avatar" class="select-avatar" />
                                </ng-container>
                                <ng-template #initialsItem>
                                    <div class="select-avatar-initials" [style.background]="selectAvatarBg(opt.label)" [style.color]="selectAvatarTextColor(opt.label)">{{ initialsFromName(opt.label) }}</div>
                                </ng-template>
                                <div>{{ opt.label }}</div>
                            </div>
                        </ng-template>
                        <ng-template let-opt pTemplate="value">
                            <div class="flex items-center gap-2">
                                <ng-container *ngIf="opt.avatar; else initialsValue">
                                    <img [src]="opt.avatar" alt="avatar" class="select-avatar" />
                                </ng-container>
                                <ng-template #initialsValue>
                                    <div class="select-avatar-initials" [style.background]="selectAvatarBg(opt.label)" [style.color]="selectAvatarTextColor(opt.label)">{{ initialsFromName(opt.label) }}</div>
                                </ng-template>
                                <div>{{ opt.label }}</div>
                            </div>
                        </ng-template>
                    </p-select>
                </div>
            </div>

            <div class="flex flex-col gap-2">
                <label for="priority" class="font-bold">{{ 'components.issues.form.PRIORITY' | translate }}</label>
                <p-select id="priority" [options]="priorityOptions" [(ngModel)]="editModel.priority" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.ANY' | translate }}" appendTo="body"></p-select>
            </div>

                        <div class="flex gap-2 mt-2">
                            <div class="flex-1 flex flex-col gap-2">
                                <label class="font-bold">{{ 'components.issues.form.DUE_DATE' | translate }}</label>
                                <p-datepicker [(ngModel)]="editModel.due_date" [showIcon]="true"></p-datepicker>
                            </div>

                            <div class="w-60 flex flex-col gap-2">
                                <label class="font-bold">{{ 'components.issues.form.ESTIMATED_HOURS' | translate }}</label>
                                <input pInputText type="number" step="8" [(ngModel)]="editModel.estimated_hours" />
                            </div>
                        </div>

                        <!-- <div class="flex flex-col gap-2 mt-2">
                            <label class="font-bold">{{ 'components.issues.form.TAGS' | translate }}</label>
                            <p-chips [(ngModel)]="editModel.tags"></p-chips>
                        </div> -->

        <div class="flex justify-end gap-2 mt-4">
            <p-button label="{{ 'MENU.CANCEL' | translate }}" (onClick)="displayDialog=false" class="p-button-text" severity="secondary" icon="pi pi-times" iconPos="left" [disabled]="loading"></p-button>
            <p-button label="{{ 'MENU.SAVE' | translate }}" (onClick)="saveIssue()" severity="primary" icon="pi pi-check" iconPos="left" [loading]="loading" [disabled]="loading"></p-button>
        </div>
    </div>
</p-dialog>

<!-- Query dialog (two-column layout) -->
<p-dialog header="{{ 'MENU.QUERY' | translate }}" [(visible)]="queryDialogVisible" [modal]="true" [appendTo]="'body'" [resizable]="false" [style]="{ width: '40%' }">
    <div class="flex flex-col gap-4">
        <div class="mb-4">
                <p-checkbox inputId="myIssue" [binary]="true" [(ngModel)]="myIssueModel"></p-checkbox>
                <label for="myIssue" class="ml-2 ">{{ 'components.issues.filters.MY_ISSUE' | translate }}</label>
            </div>
            <div class="grid grid-cols-2 gap-4">
            
            <div class="flex flex-col gap-2">
                <label class="font-bold" for="isClosed">{{ 'components.issues.filters.IS_CLOSED' | translate }}</label>
                <p-select id="isClosed" [options]="isClosedOptions" [(ngModel)]="filters.is_closed" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.ANY' | translate }}" appendTo="body"></p-select>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="projectId">{{ 'components.issues.filters.PROJECT_ID' | translate }}</label>
                <p-multiSelect id="projectId" [options]="projectOptions" [(ngModel)]="filters.project_id" optionLabel="label" optionValue="value" placeholder="{{ 'components.issues.filters.SELECT_PROJECTS' | translate }}" appendTo="body" [panelStyle]="{ 'max-height': '300px' }"></p-multiSelect>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="statusId">{{ 'components.issues.filters.STATUS_ID' | translate }}</label>
                <p-multiSelect id="statusId" [options]="statusOptions" [(ngModel)]="filters.status_id" optionLabel="label" optionValue="value" placeholder="{{ 'components.issues.filters.SELECT_STATUSES' | translate }}" appendTo="body" [panelStyle]="{ 'max-height': '300px' }"></p-multiSelect>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="assigneeId">{{ 'components.issues.filters.ASSIGNEE_ID' | translate }}</label>
                <p-multiSelect id="assigneeId" [options]="usersOptions" [(ngModel)]="filters.assignee_id" optionLabel="label" optionValue="value" placeholder="{{ 'components.issues.filters.SELECT_ASSIGNEES' | translate }}" appendTo="body" [panelStyle]="{ 'max-height': '300px' }"></p-multiSelect>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="authorId">{{ 'components.issues.filters.AUTHOR_ID' | translate }}</label>
                <p-multiSelect id="authorId" [options]="usersOptions" [(ngModel)]="filters.author_id" optionLabel="label" optionValue="value" placeholder="{{ 'components.issues.filters.SELECT_AUTHORS' | translate }}" appendTo="body" [panelStyle]="{ 'max-height': '300px' }"></p-multiSelect>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="typeId">{{ 'components.issues.filters.TYPE_ID' | translate }}</label>
                <input pInputText id="typeId" type="number" [(ngModel)]="filters.type_id" />
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="priority">{{ 'components.issues.filters.PRIORITY' | translate }}</label>
                <p-multiSelect id="priority" [options]="priorityOptions" [(ngModel)]="filters.priority" optionLabel="label" optionValue="value" placeholder="{{ 'components.issues.filters.SELECT_PRIORITIES' | translate }}" appendTo="body" [panelStyle]="{ 'max-height': '200px' }"></p-multiSelect>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="estimatedHours">{{ 'components.issues.filters.ESTIMATED_HOURS' | translate }}</label>
                <input pInputText id="estimatedHours" type="number" step="0.1" [(ngModel)]="filters.estimated_hours" />
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="estimatedMin">{{ 'components.issues.filters.ESTIMATED_HOURS_MIN' | translate }}</label>
                <input pInputText id="estimatedMin" type="number" step="0.1" [(ngModel)]="filters.estimated_hours_min" />
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="estimatedMax">{{ 'components.issues.filters.ESTIMATED_HOURS_MAX' | translate }}</label>
                <input pInputText id="estimatedMax" type="number" step="0.1" [(ngModel)]="filters.estimated_hours_max" />
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="startFrom">{{ 'components.issues.filters.START_DATE_FROM' | translate }}</label>
                <p-datepicker [(ngModel)]="filters.start_date_from" [showIcon]="true" inputId="startFrom"></p-datepicker>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="startTo">{{ 'components.issues.filters.START_DATE_TO' | translate }}</label>
                <p-datepicker [(ngModel)]="filters.start_date_to" [showIcon]="true" inputId="startTo" ></p-datepicker>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="dueFrom">{{ 'components.issues.filters.DUE_DATE_FROM' | translate }}</label>
                <p-datepicker [(ngModel)]="filters.due_date_from" [showIcon]="true" inputId="dueFrom" ></p-datepicker>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold" for="dueTo">{{ 'components.issues.filters.DUE_DATE_TO' | translate }}</label>
                <p-datepicker [(ngModel)]="filters.due_date_to" [showIcon]="true" inputId="dueTo" ></p-datepicker>
            </div>
        </div>

        <div class="flex justify-end gap-2 mt-4">
            <p-button label="{{ 'MENU.RESET' | translate }}" (onClick)="resetQuery()" class="p-button-text" severity="secondary"></p-button>
            <p-button label="{{ 'MENU.CANCEL' | translate }}" (onClick)="closeQueryDialog()" class="p-button-text" severity="secondary"></p-button>
            <p-button label="{{ 'MENU.APPLY' | translate }}" (onClick)="applyQuery()" severity="primary"></p-button>
        </div>
    </div>
</p-dialog>

<!-- Bulk edit dialog (styled like create/edit form) -->
<p-dialog header="{{ 'MENU.BULK_EDIT' | translate }}" [(visible)]="bulkEditDialogVisible" [modal]="true" [appendTo]="'body'" [resizable]="false" [style]="{ width: '40%' }">
    <div class="flex flex-col gap-4">
        <div class="mb-3">
            <strong>{{ selectedIssues.length || 0 }}</strong> {{ 'components.issues.bulk.SELECTED' | translate }}
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="flex flex-col gap-2">
                <label class="font-bold">{{ 'components.issues.bulk.STATUS' | translate }}</label>
                <p-select [options]="statusOptions" [(ngModel)]="bulkEditModel.status_id" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.ANY' | translate }}" appendTo="body"></p-select>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold">{{ 'components.issues.bulk.ASSIGNEE' | translate }}</label>
                <p-select [options]="usersOptions" [(ngModel)]="bulkEditModel.assignee_id" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.ANY' | translate }}" appendTo="body">
                    <ng-template let-opt pTemplate="item">
                        <div class="flex items-center gap-2">
                            <img *ngIf="opt.avatar" [src]="opt.avatar" alt="avatar" class="select-avatar" />
                            <div>{{ opt.label }}</div>
                        </div>
                    </ng-template>
                    <ng-template let-opt pTemplate="value">
                        <div class="flex items-center gap-2">
                            <img *ngIf="opt.avatar" [src]="opt.avatar" alt="avatar" class="select-avatar" />
                            <div>{{ opt.label }}</div>
                        </div>
                    </ng-template>
                </p-select>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold">{{ 'components.issues.form.PROJECT' | translate }}</label>
                <p-select [options]="projectOptions" [(ngModel)]="bulkEditModel.project_id" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.ANY' | translate }}" appendTo="body"></p-select>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold">{{ 'components.issues.form.TYPE' | translate }}</label>
                <p-select [options]="typeOptions" [(ngModel)]="bulkEditModel.type_id" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.ANY' | translate }}" appendTo="body"></p-select>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold">{{ 'components.issues.form.PRIORITY' | translate }}</label>
                <p-select [options]="priorityOptions" [(ngModel)]="bulkEditModel.priority" optionLabel="label" optionValue="value" placeholder="{{ 'MENU.ANY' | translate }}" appendTo="body"></p-select>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold">{{ 'components.issues.form.DUE_DATE' | translate }}</label>
                <p-datepicker [(ngModel)]="bulkEditModel.due_date" [showIcon]="true" appendTo="body"></p-datepicker>
            </div>

            <div class="flex flex-col gap-2">
                <label class="font-bold">{{ 'components.issues.form.ESTIMATED_HOURS' | translate }}</label>
                <input pInputText type="number" step="0.1" [(ngModel)]="bulkEditModel.estimated_hours" />
            </div>
        </div>

        <div class="flex justify-end gap-2 mt-4">
            <p-button label="{{ 'MENU.CANCEL' | translate }}" (onClick)="closeBulkEditDialog()" class="p-button-text" severity="secondary"></p-button>
            <p-button label="{{ 'MENU.APPLY' | translate }}" (onClick)="applyBulkEdit()" severity="primary"></p-button>
        </div>
    </div>
</p-dialog>

